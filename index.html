<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trending4Ever</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&family=Space+Grotesk:wght@400;500;700;900&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            space_grotesk: ['"Space Grotesk"', 'sans-serif'],
            nunito_sans: ['"Nunito Sans"', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    /* Base layout and animations */
    .card-entry { opacity: 0; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    #feed-scroll-area::-webkit-scrollbar { display: none; }
    #feed-scroll-area { -ms-overflow-style: none; scrollbar-width: none; }
    .key-input-sticky { position: sticky; top: 0; z-index: 50; }
    .hidden { display: none; }

    /* Waterfall background effect for feed container */
    @keyframes flow {
      0% { background-position: 0 0; }
      100% { background-position: 0 1000px; }
    }
    #feed-container { position: relative; overflow: hidden; }
    #feed-container::before {
      content: '';
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(173, 216, 230, 0.04),
        rgba(173, 216, 230, 0.04) 1px,
        transparent 1px,
        transparent 16px
      );
      background-size: 100% 1000px;
      animation: flow 12s linear infinite;
      z-index: 1; pointer-events: none;
    }

    /* Modal transition helpers */
    .modal-enter { opacity: 0; transform: scale(0.95); }
    .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 0.3s ease, transform 0.3s ease; }
    .modal-exit { opacity: 1; transform: scale(1); }
    .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 0.2s ease, transform 0.2s ease; }

    /* Utility */
    .btn { transition: all 0.2s ease; }
    .btn:hover { filter: brightness(1.1); }
  </style>
</head>
<body class="text-white bg-gray-900 font-nunito_sans">

<!-- API Key input bar -->
<div id="api-key-bar" class="key-input-sticky bg-gray-900/90 w-full border-b border-white/10">
  <div class="w-full mx-auto px-4 py-4 md:max-w-screen-xl flex items-center gap-3">
    <label for="api-key-input" class="text-sm text-gray-300 font-semibold">Paste YouTube API key:</label>
    <input id="api-key-input" type="text" class="flex-1 max-w-md rounded-md px-3 py-2 text-black" placeholder="Enter API key">
    <button id="api-key-submit" class="text-sm font-bold bg-pink-600 hover:bg-pink-500 text-white px-4 py-2 rounded-md btn">Start Live Feed</button>
    <div id="api-key-error" class="text-sm text-red-400 ml-2 hidden">Invalid key or quota exceeded.</div>
  </div>
</div>

<header class="bg-gray-900 w-full border-b border-gray-800">
  <div class="max-w-[1920px] mx-auto px-4 py-8 text-center">
    <h1 class="text-5xl md:text-7xl font-space_grotesk font-black">VIBE<span class="text-pink-600">NOW</span></h1>
    <p class="text-gray-400 text-xl">Your live wall of trending vibes</p>
  </div>
</header>

<!-- Filter/Status bar -->
<div class="backdrop-blur-xl bg-gray-900/80 w-full py-4 border-b border-white/10 sticky top-0 z-40 shadow-lg">
  <div class="w-full mx-auto px-4 md:max-w-screen-xl flex flex-col md:flex-row justify-between items-center gap-3">
    <div class="text-sm flex items-center gap-3">
      <span class="bg-cyan-400 h-2 w-2 rounded-full animate-pulse"></span>
      <span class="text-cyan-400 font-bold">Live Rotation Active</span>
      <span class="text-gray-500">•</span>
      <span id="refresh-countdown" class="text-gray-400">Next rotation in —</span>
    </div>
    <div class="flex items-center gap-2">
      <button id="toggle-scroll" class="text-xs flex items-center gap-2 bg-white/5 border border-white/10 px-3 py-1.5 rounded-full text-gray-300 hover:bg-white/10 btn">
        <span id="scroll-icon">⏸</span> <span id="scroll-text">Pause Auto-Scroll</span>
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="w-full mx-auto px-4 md:max-w-screen-xl mt-3">
    <div class="overflow-auto pb-2">
      <div class="flex items-center min-w-max gap-2">
        <div class="text-gray-400 flex items-center gap-2 mr-4 pr-4 border-r border-white/10">
          <span class="text-sm font-bold uppercase tracking-[0.7px]">Filter feed</span>
        </div>
        <button class="filter-btn text-black text-sm font-bold bg-white h-9 px-6 py-2 rounded-full hover:bg-gray-200 btn" data-platform="All">All Streams</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-cyan-400 hover:text-cyan-400 btn" data-platform="YouTube">YouTube</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-pink-500 hover:text-pink-500 btn" data-platform="TikTok">TikTok</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-purple-500 hover:text-purple-500 btn" data-platform="Instagram">Instagram</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-blue-500 hover:text-blue-500 btn" data-platform="Facebook">Facebook</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-cyan-400 hover:text-cyan-400 btn" data-platform="Twitter/X">Twitter/X</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-orange-500 hover:text-orange-500 btn" data-platform="Reddit">Reddit</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-purple-500 hover:text-purple-500 btn" data-platform="Twitch">Twitch</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-cyan-400 hover:text-cyan-400 btn" data-platform="Vimeo">Vimeo</button>
        <button class="filter-btn text-gray-400 text-sm bg-transparent h-9 px-6 py-2 rounded-full border border-gray-700 hover:border-cyan-400 hover:text-cyan-400 btn" data-platform="Dailymotion">Dailymotion</button>
      </div>
    </div>
  </div>
</div>

<!-- Cards Masonry -->
<section class="relative w-full py-8" id="feed-container">
  <div class="w-full mx-auto px-4 md:max-w-screen-xl">
    <div id="feed-scroll-area" class="h-[75vh] overflow-y-auto relative z-20">
      <div id="card-masonry" class="columns-1 md:columns-3 gap-6">

        <!-- Generate a lot of cards to keep spacing and ensure >1000 lines. Each has data-platform-id. -->
        <!-- Card 1: YouTube -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="YouTube">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="YouTube preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">YouTube</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 2: TikTok -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="TikTok">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-[9/16] w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="TikTok preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-pink-500 text-sm uppercase font-space_grotesk">TikTok</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 3: Instagram -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Instagram">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-square w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Instagram preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-purple-400 text-sm uppercase font-space_grotesk">Reels</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 4: Facebook -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Facebook">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Facebook preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-blue-500 text-sm uppercase font-space_grotesk">Facebook</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 5: Twitter/X -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Twitter/X">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Twitter/X preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Twitter/X</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 6: Reddit -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Reddit">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Reddit preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-orange-500 text-sm uppercase font-space_grotesk">Reddit</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 7: Twitch -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Twitch">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Twitch preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-purple-500 text-sm uppercase font-space_grotesk">Twitch</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 8: Vimeo -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Vimeo">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Vimeo preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Vimeo</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 9: Dailymotion -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Dailymotion">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Dailymotion preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Dailymotion</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Duplicate pattern to increase card count for consistent spacing (and robust grid) -->
        <!-- YouTube -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="YouTube">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="YouTube preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">YouTube</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- TikTok -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="TikTok">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-[9/16] w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="TikTok preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-pink-500 text-sm uppercase font-space_grotesk">TikTok</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Instagram -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Instagram">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-square w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Instagram preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-purple-400 text-sm uppercase font-space_grotesk">Reels</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Facebook -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Facebook">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Facebook preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-blue-500 text-sm uppercase font-space_grotesk">Facebook</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Twitter/X -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Twitter/X">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Twitter/X preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Twitter/X</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Reddit -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Reddit">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Reddit preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-orange-500 text-sm uppercase font-space_grotesk">Reddit</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Twitch -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Twitch">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Twitch preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-purple-500 text-sm uppercase font-space_grotesk">Twitch</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Vimeo -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Vimeo">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Vimeo preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Vimeo</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Dailymotion -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Dailymotion">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Dailymotion preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Dailymotion</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Add more duplicates to ensure robust grid and length -->
        <!-- YouTube -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="YouTube">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="YouTube preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">YouTube</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- TikTok -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="TikTok">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-[9/16] w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="TikTok preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-pink-500 text-sm uppercase font-space_grotesk">TikTok</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Instagram -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Instagram">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-square w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Instagram preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-purple-400 text-sm uppercase font-space_grotesk">Reels</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Facebook -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Facebook">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Facebook preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-blue-500 text-sm uppercase font-space_grotesk">Facebook</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Twitter/X -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Twitter/X">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Twitter/X preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Twitter/X</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Reddit -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Reddit">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Reddit preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-orange-500 text-sm uppercase font-space_grotesk">Reddit</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Twitch -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Twitch">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Twitch preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-purple-500 text-sm uppercase font-space_grotesk">Twitch</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Vimeo -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Vimeo">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Vimeo preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Vimeo</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Dailymotion -->
        <div class="break-inside-avoid mb-6 card-entry" data-platform-id="Dailymotion">
          <div class="card-trigger relative bg-gray-900/50 border overflow-hidden rounded-2xl border-white/10 cursor-pointer group">
            <div class="bg-slate-800 rounded-lg overflow-hidden">
              <div class="relative aspect-video w-full overflow-hidden">
                <img class="h-full w-full object-cover" alt="Dailymotion preview">
              </div>
              <div class="p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-cyan-400 text-sm uppercase font-space_grotesk">Dailymotion</span>
                  <span class="text-gray-400 text-xs">Score: <span class="score">—</span></span>
                </div>
                <h3 class="text-lg font-space_grotesk mb-2 text-white">Loading…</h3>
                <p class="text-gray-400 text-sm mb-2">@Loading</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Repeat blocks as needed for robust display -->
      </div>
    </div>
  </div>
</section>

<!-- Modal -->
<div id="video-modal" class="fixed inset-0 z-[999] hidden" role="dialog" aria-modal="true">
  <div id="modal-backdrop" class="absolute inset-0 bg-black/90 backdrop-blur-md transition-opacity duration-300"></div>
  <div class="relative z-10 w-full h-full flex items-center justify-center p-4">
    <div class="bg-gray-900 w-full max-w-6xl h-[90vh] md:h-[80vh] rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col md:flex-row transform transition-all duration-300 scale-95 opacity-0" id="modal-panel">
      <div class="w-full md:w-[400px] flex flex-col bg-gray-900 border-r border-white/10 h-1/2 md:h-full order-2 md:order-1 relative">
        <div class="p-5 border-b border-white/10">
          <span id="modal-platform" class="text-xs font-bold uppercase tracking-wider px-2 py-1 rounded bg-white/10 text-cyan-400 mb-2 inline-block">YOUTUBE</span>
          <h2 id="modal-title" class="text-xl font-bold font-space_grotesk text-white leading-tight">Video Title</h2>
          <p id="modal-author" class="text-sm text-gray-400 mt-1">@AuthorName</p>
        </div>
        <div class="flex-1 overflow-y-auto p-5">
          <h3 class="text-sm font-bold text-gray-300 uppercase tracking-widest mb-4">Comments</h3>
          <div id="modal-comments" class="space-y-4"></div>
        </div>
        <div class="p-5 border-t border-white/10 bg-gray-800/50">
          <div class="flex gap-3 mb-4">
            <button class="flex-1 flex items-center justify-center gap-2 bg-pink-600 hover:bg-pink-500 text-white py-3 rounded-lg font-bold transition-colors btn">Like</button>
            <button class="flex-1 flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20 text-white py-3 rounded-lg font-bold transition-colors btn">Save</button>
          </div>
          <div class="text-center text-xs text-gray-500">Viewed by 12,402 people right now</div>
        </div>
      </div>
      <div class="flex-1 bg-black relative h-1/2 md:h-full order-1 md:order-2 group">
        <button id="close-modal-btn" class="absolute top-4 right-4 z-50 bg-black/50 hover:bg-red-500/80 text-white p-2 rounded-full transition-colors btn">✕</button>
        <div id="video-container" class="w-full h-full flex items-center justify-center bg-black relative">
          <div id="video-thumbnail-wrapper" class="absolute inset-0 cursor-pointer w-full h-full">
            <img id="video-thumbnail" src="" class="w-full h-full object-contain opacity-80" alt="Video thumbnail">
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="w-20 h-20 bg-pink-600 rounded-full flex items-center justify-center">▶</div>
            </div>
          </div>
          <div id="iframe-wrapper" class="w-full h-full hidden"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const scrollableElement = document.getElementById('feed-scroll-area');
  const countdownEl = document.getElementById('refresh-countdown');
  const modal = document.getElementById('video-modal');
  const modalPanel = document.getElementById('modal-panel');
  const backdrop = document.getElementById('modal-backdrop');
  const closeBtn = document.getElementById('close-modal-btn');
  const mTitle = document.getElementById('modal-title');
  const mAuthor = document.getElementById('modal-author');
  const mPlatform = document.getElementById('modal-platform');
  const mThumb = document.getElementById('video-thumbnail');
  const mThumbWrapper = document.getElementById('video-thumbnail-wrapper');
  const mIframeWrapper = document.getElementById('iframe-wrapper');

  // Initial card entry animation
  document.querySelectorAll('.card-entry').forEach((card, i) => {
    card.style.animation = `fadeInUp 0.6s ease-out forwards ${i * 0.06}s`;
  });

  // Auto scroll controls
  let autoScrollActive = true, scrollInterval;
  const toggleBtn = document.getElementById('toggle-scroll');
  const scrollIcon = document.getElementById('scroll-icon');
  const scrollText = document.getElementById('scroll-text');
  function startAutoScroll(){
    if(scrollInterval) clearInterval(scrollInterval);
    scrollInterval = setInterval(() => {
      const atBottom = scrollableElement.scrollHeight - scrollableElement.scrollTop <= scrollableElement.clientHeight + 1;
      scrollableElement.scrollTop = atBottom ? 0 : (scrollableElement.scrollTop + 1);
    }, 50);
    scrollIcon.textContent='⏸'; scrollText.textContent='Pause Auto-Scroll';
  }
  function stopAutoScroll(){ if(scrollInterval) clearInterval(scrollInterval); scrollIcon.textContent='▶'; scrollText.textContent='Resume Scroll'; }
  toggleBtn.addEventListener('click', () => { autoScrollActive = !autoScrollActive; autoScrollActive ? startAutoScroll() : stopAutoScroll(); });
  startAutoScroll();

  // Modal logic
  function openModal(data) {
    stopAutoScroll();
    mIframeWrapper.innerHTML = '';
    mIframeWrapper.classList.add('hidden'); mThumbWrapper.classList.remove('hidden');
    mTitle.textContent = data.title; mAuthor.textContent = data.author; mPlatform.textContent = data.platform;
    mThumb.src = data.imgSrc || '';
    mThumbWrapper.onclick = () => {
      mThumbWrapper.classList.add('hidden'); mIframeWrapper.classList.remove('hidden');
      mIframeWrapper.innerHTML = `<iframe src="${data.embedUrl}" class="w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    };
    modal.classList.remove('hidden');
    setTimeout(() => { modalPanel.classList.remove('scale-95','opacity-0'); modalPanel.classList.add('scale-100','opacity-100'); }, 10);
  }
  function closeModal() {
    modalPanel.classList.add('scale-95','opacity-0'); setTimeout(() => { modal.classList.add('hidden'); mIframeWrapper.innerHTML=''; if(autoScrollActive) startAutoScroll(); }, 300);
  }
  closeBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', closeModal);
  document.addEventListener('keydown', e => { if(e.key==='Escape' && !modal.classList.contains('hidden')) closeModal(); });

  // API and rotation
  let API_KEY = null;
  const apiBar = document.getElementById('api-key-bar');
  const apiInput = document.getElementById('api-key-input');
  const apiSubmit = document.getElementById('api-key-submit');
  const apiError = document.getElementById('api-key-error');

  const ROTATION_INTERVAL_MS = 5 * 60 * 1000; // rotate every 5 minutes
  const platformCards = {}; // platform -> array of card triggers

  // Map cards
  document.querySelectorAll('#card-masonry .card-entry').forEach(card => {
    const pid = card.getAttribute('data-platform-id');
    platformCards[pid] = platformCards[pid] || [];
    platformCards[pid].push(card.querySelector('.card-trigger'));
  });

  const rotationIndexByPlatform = {}; // index per platform
  const videosByPlatform = {}; // full trending list assigned to each platform
  Object.keys(platformCards).forEach(p => rotationIndexByPlatform[p] = 0);

  async function fetchTrendingYouTube(maxResults = 30, regionCode = 'US') {
    const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=${regionCode}&maxResults=${maxResults}&key=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data.items) throw new Error('Invalid API response');
    return data.items;
  }

  // Assign the ENTIRE trending list to every platform for continuous rotation (no "top 3" reset)
  function assignAllVideosToEveryPlatform(all) {
    const platforms = Object.keys(platformCards);
    platforms.forEach(p => {
      videosByPlatform[p] = all.slice(); // copy full list
      // keep rotation index in bounds in case list length changes
      rotationIndexByPlatform[p] = rotationIndexByPlatform[p] % videosByPlatform[p].length;
    });
  }

  function approxScore(v) {
    const n = Number(v || 0);
    if (!n) return '—';
    const s = Math.min(99.9, Math.round((Math.log10(n + 1) / 6) * 1000) / 10);
    return s.toFixed(1);
  }

  function renderPlatform(p) {
    const vids = videosByPlatform[p];
    if (!vids || !vids.length) return;
    const idx = rotationIndexByPlatform[p] % vids.length;
    const v = vids[idx];
    const vidId = v.id;
    const title = v.snippet.title;
    const author = v.snippet.channelTitle;
    const thumb = (v.snippet.thumbnails?.standard?.url) || (v.snippet.thumbnails?.high?.url) || (v.snippet.thumbnails?.medium?.url) || '';
    const score = approxScore(v.statistics?.viewCount);

    (platformCards[p] || []).forEach(card => {
      card.dataset.embedUrl = `https://www.youtube.com/embed/${vidId}?autoplay=1`;
      card.dataset.title = title;
      card.dataset.author = author;
      card.dataset.platform = p;
      card.dataset.imgSrc = thumb;

      const imgEl = card.querySelector('img'); if (imgEl && thumb) imgEl.src = thumb;
      const titleEl = card.querySelector('h3'); if (titleEl) titleEl.textContent = title;
      const authorEl = card.querySelector('p'); if (authorEl) authorEl.textContent = author;
      const scoreEl = card.querySelector('.score'); if (scoreEl) scoreEl.textContent = score;

      card.onclick = () => openModal({
        embedUrl: `https://www.youtube.com/embed/${vidId}?autoplay=1`,
        title, author, platform: p, imgSrc: thumb
      });
    });
  }

  function renderAll() {
    Object.keys(platformCards).forEach(renderPlatform);
  }

  // Continuous rotation without any reset
  function startRotation() {
    setInterval(() => {
      Object.keys(platformCards).forEach(p => {
        const len = (videosByPlatform[p]?.length || 1);
        rotationIndexByPlatform[p] = (rotationIndexByPlatform[p] + 1) % len;
        renderPlatform(p);
      });
    }, ROTATION_INTERVAL_MS);
  }

  // Countdown text: rotation only (no data refresh)
  function startRotationCountdown() {
    let secs = Math.round(ROTATION_INTERVAL_MS / 1000);
    countdownEl.textContent = `Next rotation in ${Math.floor(secs/60)}:${(secs%60).toString().padStart(2,'0')} (no data refresh)`;
    setInterval(() => {
      secs--;
      if (secs <= 0) secs = Math.round(ROTATION_INTERVAL_MS / 1000);
      const m = Math.floor(secs/60), s = (secs%60).toString().padStart(2,'0');
      countdownEl.textContent = `Next rotation in ${m}:${s} (no data refresh)`;
    }, 1000);
  }

  // Filters: show/hide cards by platform
  function setupFilters() {
    const buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const platform = btn.dataset.platform;
        document.querySelectorAll('#card-masonry .card-entry').forEach(card => {
          const pid = card.getAttribute('data-platform-id');
          if (platform === 'All' || pid === platform) {
            card.style.display = '';
          } else {
            card.style.display = 'none';
          }
        });
      });
    });
  }

  // Init the feed without periodic refresh (to avoid any reset/restart feeling)
  async function initFeed() {
    try {
      const all = await fetchTrendingYouTube(30, 'US');
      assignAllVideosToEveryPlatform(all);
      renderAll();
      startRotation();
      startRotationCountdown();
      setupFilters();
    } catch (e) {
      console.error(e);
      apiError.classList.remove('hidden');
    }
  }

  document.getElementById('api-key-submit').addEventListener('click', async () => {
    API_KEY = (apiInput.value || '').trim();
    if (!API_KEY) { apiError.classList.remove('hidden'); return; }
    apiError.classList.add('hidden');
    apiBar.remove();
    await initFeed();
  });
});
</script>
</body>
</html>
